name: ğŸ“š Build Mod Wiki (Skeleton)

on:
  push:
    branches: [main, master]
    paths:
      - 'jsons/**'
      - 'Images/**'
      - '.github/workflows/build-mod-wiki.yml'
  workflow_dispatch:  # æ‰‹åŠ¨è§¦å‘æŒ‰é’®

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      # =============== 1. æ£€å‡ºä»£ç  ===============
      - name: ğŸ›ï¸ Checkout repository
        uses: actions/checkout@v4

      # =============== 2. ä¸‹è½½æ¸¸æˆæœ¬ä½“ç¿»è¯‘ ===============
      - name: ğŸŒ Download base game translations
        run: |
          mkdir -p translations_base
          echo "Downloading English.properties..."
          curl -fsSL "https://raw.githubusercontent.com/yairm210/Unciv/master/android/assets/jsons/translations/English.properties" -o translations_base/English.properties || echo "âš ï¸ Failed to download English.properties"
          echo "Downloading Simplified_Chinese.properties..."
          curl -fsSL "https://raw.githubusercontent.com/yairm210/Unciv/master/android/assets/jsons/translations/Simplified_Chinese.properties" -o translations_base/Simplified_Chinese.properties || echo "âš ï¸ Failed to download Simplified_Chinese.properties"
          ls -lh translations_base/

      # =============== 3. åˆå¹¶ç¿»è¯‘ï¼ˆå ä½ï¼šåç»­æ›¿æ¢ä¸º merge_translations.pyï¼‰ ===============
      - name: ğŸ”€ Merge translations (Local > Base)
        run: |
          mkdir -p translations
          # ä¸´æ—¶é€»è¾‘ï¼šç›´æ¥å¤åˆ¶æœ¬åœ°ç¿»è¯‘ï¼ˆåç»­ç”¨Pythonè„šæœ¬ç²¾å‡†åˆå¹¶ï¼‰
          if [ -d "jsons/translations" ]; then
            cp jsons/translations/*.properties translations/ 2>/dev/null || echo "âš ï¸ No local translations found"
            echo "âœ… Local translations copied to ./translations/"
          else
            echo "âš ï¸ Local translations folder not found (jsons/translations/)"
          fi
          # éªŒè¯åˆå¹¶ç»“æœ
          echo "=== Merged translations preview ==="
          head -5 translations/*.properties 2>/dev/null || echo "No translations available"

      # =============== 4. ç”Ÿæˆæ–‡æ¡£ï¼ˆå ä½ï¼šåç»­æ›¿æ¢ä¸º generate_wiki.pyï¼‰ ===============
      - name: ğŸ“ Generate Wiki Pages (Placeholder)
        run: |
          mkdir -p wiki-output
          echo "# CoeHarMod Wiki (Build: ${{ github.sha }})" > wiki-output/index.md
          echo "- Status: Workflow skeleton verified" >> wiki-output/index.md
          echo "- Next: Implement generate_wiki.py" >> wiki-output/index.md
          echo "- Images folder exists: $(ls Images 2>/dev/null | wc -l) files" >> wiki-output/index.md
          echo "- JSON files found: $(find jsons -name '*.json' -not -path '*/translations/*' | wc -l)" >> wiki-output/index.md
          cat wiki-output/index.md

      # =============== 5. éƒ¨ç½²åˆ° GitHub Pages ===============
      - name: ğŸŒ Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        if: success()  # ä»…å½“ä¸Šä¸€æ­¥æˆåŠŸæ—¶éƒ¨ç½²
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./wiki-output
          publish_branch: gh-pages
          keep_files: false  # æ¯æ¬¡å…¨é‡è¦†ç›–
          commit_message: "docs: auto-update wiki (sha: ${{ github.sha }})"